<table class="table table-condensed table-fixed">
    <tr>
        <th>
            #
        </th>
        <th>
            URL
        </th>
        <th>
            Line
        </th>
        <th>
            Function
        </th>
        <th></th>
    </tr>
    <% trace.each.with_index do |frame, i| %>
        <tr id="<%= id %>-<%= i %>">
            <th>
                <strong>
                    <a href="<%= id_to_location id %>/<%= i %>">
                        <%= i %>
                    </a>
                </strong>
            </th>
            <td>
                <a href="<%= escapeHTML frame.url %>">
                    <%= escapeHTML frame.url %>
                </a>
            </td>
            <td>
                <% if frame.line.to_i > 0 && frame.url == page.dom.url %>
                    <a href="<%= id_to_location id %>/<%= i %>/inspect/source/page/<%= frame.line %>">
                        <%= frame.line %>
                    </a>
                <% else %>
                    <%= frame.line %>
                <% end %>
            </td>
            <td>
                <% if frame.function %>
                    <code><%= frame.function %></code>
                <% end %>
            </td>

            <% if frame.function && (frame.line.to_i > 0 && frame.url == page.dom.url) || !frame.source.to_s.empty? %>
                <td>
                    <a href="javascript:void(0);"
                       onclick="$('#<%= id %>-<%= i %>-inspect').toggle()"
                       class="btn btn-info btn-xs">
                        Inspect
                    </a>
                </td>
            <% end %>
        </tr>

        <% if frame.function && (frame.line.to_i > 0 && frame.url == page.dom.url) || !frame.source.to_s.empty? %>
            <tr id="<%= id %>-<%= i %>-inspect" style="display: none">
                <td colspan="5" class="borderless">
                    <ul class="nav nav-tabs">

                        <% has_active = false %>
                        <% if frame.function %>
                            <% has_active = true %>
                            <li class="active">
                                <a href="<%= id_to_location id %>/<%= i %>/inspect/arguments">
                                    Arguments
                                </a>
                            </li>
                        <% end %>

                        <% if (frame.line.to_i > 0 && frame.url == page.dom.url) || !frame.source.to_s.empty? %>
                            <li <%= 'class="active"' if !has_active %> >
                                <a href="<%= id_to_location id %>/<%= i %>/inspect/source">
                                    Source
                                </a>
                            </li>
                        <% end %>
                    </ul>

                    <div class="tab-content">

                        <% has_active = false %>
                        <% if frame.function %>
                            <% has_active = true %>
                            <div class="tab-pane active" id="<%= id %>-<%= i %>-inspect-arguments">
                                <%= data_dump frame.arguments %>
                            </div>
                        <% end %>

                        <% if (frame.line.to_i > 0 && frame.url == page.dom.url) || !frame.source.to_s.empty? %>
                            <div class="tab-pane <%= 'active' if !has_active %> " id="<%= id %>-<%= i %>-inspect-source">
                                <%= erb 'issue/page/sink/frame/source.erb',
                                        id:    "#{id}-#{i}-inspect",
                                        frame: frame,
                                        page:  page
                                %>
                            </div>
                        <% end %>
                    </div>

                </td>
            </tr>
        <% end %>
    <% end %>
</table>

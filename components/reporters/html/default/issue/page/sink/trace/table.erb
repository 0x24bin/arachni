<table class="table table-condensed table-fixed">
    <col width="5%" />
    <col width="70%" />
    <col width="5%" />
    <col width="10%" />
    <col width="10%" />

    <tr>
        <th>
            #
        </th>
        <th>
            URL
        </th>
        <th>
            Line
        </th>
        <th>
            Function
        </th>
        <th></th>
    </tr>
    <% trace.each.with_index do |frame, i| %>
        <tr id="<%= id %>-<%= i %>">
            <th>
                <strong>
                    <a href="<%= id_to_location id %>/<%= i %>">
                        <%= i %>
                    </a>
                </strong>
            </th>
            <td>
                <a href="<%= escapeHTML frame.url %>">
                    <%= escapeHTML frame.url %>
                </a>
            </td>
            <td>
                <% if frame.line.to_i > 0 && frame.url == page.dom.url %>
                    <a href="<%= id_to_location id %>/<%= i %>/inspect/source/page/<%= frame.line %>">
                        <%= frame.line %>
                    </a>
                <% else %>
                    <%= frame.line %>
                <% end %>
            </td>
            <td>
                <% if frame.function %>
                    <code><%= frame.function %></code>
                <% end %>
            </td>

            <td>
                <a href="javascript:void(0);"
                   onclick="$('#<%= id %>-<%= i %>-inspect').toggle()"
                   class="btn btn-info btn-xs">
                    Inspect
                </a>
            </td>
        </tr>

        <tr id="<%= id %>-<%= i %>-inspect" style="display: none">
            <td colspan="5" class="borderless">
                <ul class="nav nav-tabs">

                    <li class="active">
                        <a href="<%= id_to_location id %>/<%= i %>/inspect/arguments">
                            Arguments
                        </a>
                    </li>

                    <% if (frame.line.to_i > 0 && frame.url == page.dom.url) || !frame.source.to_s.empty? %>
                        <li>
                            <a href="<%= id_to_location id %>/<%= i %>/inspect/source">
                                Source
                            </a>
                        </li>
                    <% end %>
                </ul>

                <div class="tab-content">

                    <div class="tab-pane active" id="<%= id %>-<%= i %>-inspect-arguments">
                        <%= data_dump frame.arguments %>
                    </div>

                    <% if (frame.line.to_i > 0 && frame.url == page.dom.url) || !frame.source.to_s.empty? %>
                        <div class="tab-pane" id="<%= id %>-<%= i %>-inspect-source">
                            <%= erb 'issue/page/sink/frame/source.erb',
                                    id:    "#{id}-#{i}-inspect",
                                    frame: frame,
                                    page:  page
                            %>
                        </div>
                    <% end %>
                </div>

            </td>
        </tr>
    <% end %>
</table>
